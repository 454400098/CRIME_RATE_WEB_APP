{% extends "base.html" %}


{% block head %}
  {{ super() }}
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<!-- for geoarr init -->

<!-- for geoarr init -->

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
    integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
    crossorigin=""/>

    <!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
  integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
  crossorigin=""></script>


  <link rel="stylesheet" href="./static/lib/css//bootstrap.min.css">
  <link rel="stylesheet" href="./static/lib/css/keen-dashboards.css">
  <link rel="stylesheet" href="./static/lib/css/dc.css">
  <link rel="stylesheet" href="./static/css/custom.css">
  <!-- Include CARTO.js -->
  <script src="https://libs.cartocdn.com/carto.js/v4.1.11/carto.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:600" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <link href="https://carto.com/developers/carto-js/examples/maps/public/style.css" rel="stylesheet">



{% endblock %}



{% block content %}


  <div class="application">
    <!-- <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="./"> Dashboard</a>
      </div>
    </div>
  </div> -->


  <div class="container-fluid">
    <div class="row">

      <div class="col-sm-6">
        <div class="row">

          <!-- Time Chart -->
          <div class="col-sm-14">
            <div class="chart-wrapper">
              <div class="chart-title">
                Number of GUN VIOLENCE
              </div>
              <div class="chart-stage">
                <div id="time-chart"></div>
              </div>
            </div>
          </div>
          <!-- Time Chart -->

          <!-- Resources Pie -->
          <div class="col-sm-14">
            <div class="chart-wrapper">
              <div class="chart-title">
                Number of Victim [<font style="color:#ff80c0;">child_victim</font>]
                                 [<font style="color:#331926;">teen_victim</font>]
                                 [<font style="color:#ffc080;">adult_victim</font>]
              </div>
              <div class="chart-stage">
                <div id="victim-chart"></div>

              </div>
            </div>
          </div>
          <!-- Resources Pie -->

          <!-- Poverty Pie -->
          <!-- <div class="col-sm-6">
            <div class="chart-wrapper">
              <div class="chart-title">
                Poverty Level
              </div>
              <div class="chart-stage">
                <div id="poverty-level-row-chart"></div>
              </div>
            </div>
          </div> -->
          <!-- Poverty Pie -->

        </div>
      </div>

      <!-- Map -->
      <div class="col-sm-6">

        <div class="chart-wrapper">
          <div class="chart-title">





          </div>
          <div class="chart-stage">
            <div id="us-chart"></div>

      </div>
      <!-- Map -->

      <!-- Metric 1 -->
      <div class="col-sm-3">
        <div class="chart-wrapper">
          <div class="chart-title">
            Total Number of Gun Violence
          </div>
          <div class="chart-stage">
            <div id="number-projects-nd"></div>
          </div>
        </div>
      </div>
      <!-- Metric 1 -->

      <!-- Metric 2 -->
      <div class="col-sm-3">
        <div class="chart-wrapper">
          <div class="chart-title">
            Total killed
          </div>
          <div class="chart-stage">
            <div id="total-donations-nd"></div>
          </div>
        </div>
      </div>
      <!-- Metric 2 -->

      <!-- Metric 3 -->
      <div class="col-sm-3">
        <div class="chart-wrapper">
          <div class="chart-title">
            Total injured
          </div>
          <div class="chart-stage">
            <div id="total-injured-nd"></div>
          </div>
        </div>
      </div>
      <!-- Metric 3 -->


      <!-- Metric 4 -->

      <!-- Metric 4 -->

    </div>

    <div class="dc-date-count" style = "float:left;">
        <a href="javascript:dc.filterAll();dc.renderAll();">Reset All</a>
      </h2>
    </div>

    <div class="col-sm-6">
      <div class="chart-wrapper">
        <div class="chart-title">
          Killed Ranking Tables
        </div>
        <div class="chart-stage">
          <div id="killed"></div>
        </div>
      </div>
    </div>
  </div>


  <script src="./static/lib/js/jquery.min.js"></script>
  <script src="./static/lib/js/bootstrap.min.js"></script>
  <script src="./static/lib/js/crossfilter.js"></script>
  <script src="./static/lib/js/d3.js"></script>
  <script src="./static/lib/js/dc.js"></script>
  <script src="./static/lib/js/queue.js"></script>
  <!-- <script src="http://d3js.org/queue.v1.min.js"></script> -->
  <script src="./static/lib/js/keen.min.js"></script>
  <script src='./static/js/zipinfo.js' type='text/javascript'>

  </script>


  </div>

  <style type='text/css'>
  .my-legend .legend-title {
    text-align: left;
    margin-bottom: 8px;
    font-weight: bold;
    font-size: 90%;
    }
  .my-legend .legend-scale ul {
    margin: 0;
    padding: 0;
    float: left;
    list-style: none;
    }
  .my-legend .legend-scale ul li {
    display: block;
    float: left;
    width: 50px;
    margin-bottom: 6px;
    text-align: center;
    font-size: 80%;
    list-style: none;
    }
  .my-legend ul.legend-labels li span {
    display: block;
    float: left;
    height: 15px;
    width: 50px;
    }
  .my-legend .legend-source {
    font-size: 70%;
    color: #999;
    clear: both;
    }
  .my-legend a {
    color: #777;
    }
  </style>



<div class="flex-container">
<div>
  <!-- <p>TEST RESULT PAGE</p> -->
  <table border = 1>
      <tr>
        <th>{{result}}</th>
      </tr>
</div>





<div>
  <input type="text" placeholder="Enter a zip code" id="zip" onkeydown="lonlat()" autocomplete="off"/>
  <p id="lonlat"></p>
</div>



<!-- <script type="text/javascript">
  var nj_data;
  console.log('Reading NJ BOUNDARY!!!!!!');
  $.getJSON("./static/geojson/nj.geojson", function(json) {
    console.log('this is read data',json);
    nj_data = json;
  });

</script> -->



<!-- read local location json file -->
<script type="text/javascript">
  var data;
  console.log('Reading local json file!!!!!!');
  $.getJSON("./static/second/location.json", function(json) {
    console.log('this is read data',json); // this will show the info it in firebug console
    data = json;
});
console.log('finished reading local json file!!!!!!');
</script>


<!-- read local location json file -->

<script type="text/javascript">
  var myGeocode = [40.7831,-73.985130];
  var input = {{result['Area']|tojson}}
  var lonlat = document.getElementById('lonlat');
  console.log(input);
  if (input.length === 5) {
    // console.log('i am here');
    var xhr = $.get('https://maps.googleapis.com/maps/api/geocode/json?address=' + input + '&key=AIzaSyAl1n9grfDTDBHCHX8rlfyo4QKv_uuz4E4');
    xhr.done(function(data) {
      lonlat.innerHTML = 'Latitude = ' + data.results[0].geometry.location.lat + ' ' + '<br>Longitude = ' + data.results[0].geometry.location.lng;
      myGeocode[0] = data.results[0].geometry.location.lat;
      myGeocode[1] = data.results[0].geometry.location.lng;
      // console.log('finished computation');
      console.log(myGeocode[0]);
      console.log(myGeocode[1]);
    });
  }
  // console.log('now ans is ');
  // console.log(myGeocode[0]);
</script>



<button id = "action" type="button" name="button"  >Show map</button>
<div id="mapid" style="width: 600px; height: 400px;"></div>
</div>


<script type="text/javascript">
function mapDisplay(){
  var mymap = L.map('mapid').setView([myGeocode[0], myGeocode[1]], 13);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}.png', {
    maxZoom: 15,
  }).addTo(mymap);
  const client = new carto.Client({
  apiKey: 'f5a9e0398003a5741b1dd6ab8f35950b2c581be6',
  username: '454400098'
});

 const Dataset = new carto.source.Dataset(`out`);
 //
 // const bou = new carto.source.Dataset(`
 //   SELECT * FROM out WHERE geoid10 IN ('08854','08817','10024')
 // `);

 const style = new carto.style.CartoCSS(`
   #out  {polygon-fill: #7bd490;
          polygon-opacity: 0.7;
          line-color: #6da57a;
          line-width: 0.5;
          line-opacity: 1;
        }
 `);

 const layer = new carto.layer.Layer(Dataset, style);

client.addLayer(layer);
client.getLeafletLayer().addTo(mymap);
// loop to make make marker
var i;
console.log(data);
for(i = 0; i < data.length;i++){
    L.circle([data[i]['latitude'],data[i]['longitude']],{
      color: 'red',
      fillColor: '#f03',
      fillOpacity: 0.5,
      radius: 50
  })
  .bindPopup(data[i]['source_url'])
  .addTo(mymap);
//add boundary to map
// var myLayer = L.geoJSON().addTo(mymap);
// myLayer.addData(nj_data)

// var myLayer = L.geoJSON(data,{
//     filter: function(feature,layer){
//       return feature.properties.ZCTA5CE10 == 08854;
//     }
// }).addTo(mymap);


}
// var marker = L.marker([40.5942,-74.4536]).addTo(mymap);
};

$(function() {
    $('#action').click(mapDisplay);
});


</script>

{% endblock %}


<!-- {% block map %}




{% endblock %} -->
